<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Our Story ‚ù§Ô∏è</title>

<style>
html, body {
    margin:0;
    padding:0;
    height:100%;
    overflow:hidden;
    background:black;
}

/* Iframe */
#stageFrame {
    width:100vw;
    height:100vh;
    border:none;
    opacity:1;
    transition:opacity 0.6s ease;
}

.fade-out {
    opacity:0;
}

/* Loader */
#loader {
    position:fixed;
    inset:0;
    background:linear-gradient(135deg,#ff2f7d,#ff8fab);
    display:flex;
    justify-content:center;
    align-items:center;
    z-index:9999;
    transition:opacity 0.5s ease;
}

#loader.hidden {
    opacity:0;
    pointer-events:none;
}

.loader-heart {
    font-size:60px;
    animation:pulse 1.2s infinite;
}

@keyframes pulse {
    0% { transform:scale(1); }
    50% { transform:scale(1.2); }
    100% { transform:scale(1); }
}
</style>
</head>

<body>

<!-- üéµ AUDIO -->
<audio id="music" loop preload="auto">
    <source src="music.mp3" type="audio/mpeg">
</audio>

<!-- Loader -->
<div id="loader">
    <div class="loader-heart">‚ù§Ô∏è</div>
</div>

<!-- Stage Frame -->
<iframe id="stageFrame" src="intro/intro.html"></iframe>

<script>
const music = document.getElementById("music");
const frame = document.getElementById("stageFrame");
const loader = document.getElementById("loader");

/* ===== MUSIC FIX ===== */

function startMusicOnce(){
    music.play().catch(() => {});
    document.removeEventListener("click", startMusicOnce);
    document.removeEventListener("touchstart", startMusicOnce);
}

document.addEventListener("click", startMusicOnce);
document.addEventListener("touchstart", startMusicOnce);

/* Try autoplay immediately */
window.addEventListener("load", () => {
    music.play().catch(() => {
        // silently fallback to interaction
    });
});

/* ===== STAGE SWITCHING ===== */

function goToStage(stageName){

    loader.classList.remove("hidden");
    frame.classList.add("fade-out");

    setTimeout(()=>{

        switch(stageName){
            case "intro":
                frame.src = "intro/intro.html";
                break;
            case "memories":
                frame.src = "memories/memories.html";
                break;
            case "timeline":
                frame.src = "timeline/timeline.html";
                break;
            case "future":
                frame.src = "future/future.html";
                break;
            case "letter":
                frame.src = "letter/letter.html";
                break;
        }

    },300);
}

/* Hide loader exactly when iframe loads */
frame.onload = function(){
    frame.classList.remove("fade-out");
    loader.classList.add("hidden");
};

window.goToStage = goToStage;
</script>

</body>
</html>
